///////////////////////////////////////////////////////////
//  System16/s16/asm/sys16.s16a                          //
///////////////////////////////////////////////////////////
//
//  The s16 shell.
//


///////////////////////////////////////////////////////////
//  Initialises I/O devices                              //
///////////////////////////////////////////////////////////
//
    .include    lib/io/hw.s16a

///////////////////////////////////////////////////////////
//  I/O libraries                                        //
///////////////////////////////////////////////////////////
//
    .include    lib/io/mon.s16a
    .include    lib/io/kbd.s16a

///////////////////////////////////////////////////////////
//  Include the repl                                     //
///////////////////////////////////////////////////////////
//
    .include    sys/repl.s16a


.section        ro

    m8          __s16_title[18]         = "*** s16 ready ***"


.section        code


///////////////////////////////////////////////////////////
//  _main                                                //
///////////////////////////////////////////////////////////
//
    function    _main

        push16  %BP
        mov16   BP, %SP

    ///////////////////////////////////////////////////////
    //  On initialisation we need to set up the input
    //  and output devices.
    //
    //  The __init_io function is in:
    //
    //      System16/s16/asm/lib/io/hw.s16a
    //
        call    __init_io

    ///////////////////////////////////////////////////////
    //  Print the title before running the REPL.
    //
        push16  __s16_title
        call    print
        pop16   AX
        
    ///////////////////////////////////////////////////////
    //  Now we can run the REPL - see:
    //
    //      System16/s16/asm/sys/repl.s16a
    //
        call    repl

        pop16   BP
        ret     0
        
    end

